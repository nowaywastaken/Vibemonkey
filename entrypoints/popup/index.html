<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Vibemonkey</title>
    <meta name="manifest.type" content="browser_action" />
  </head>
  <body>
    <div id="app">
      <!-- Header -->
      <header class="header">
        <div class="logo">
          <span class="logo-icon">ğŸµ</span>
          <span class="logo-text">Vibemonkey</span>
        </div>
        <div class="header-actions">
          <label class="toggle-switch" title="æ‰©å±•å¯ç”¨çŠ¶æ€">
            <input type="checkbox" id="extension-toggle" checked />
            <span class="toggle-slider"></span>
          </label>
          <button id="settings-btn" class="icon-btn" title="è®¾ç½®">âš™ï¸</button>
        </div>
      </header>

      <!-- Current Domain Info -->
      <div class="domain-bar">
        <span class="domain-icon">ğŸŒ</span>
        <span id="current-domain" class="current-domain">-</span>
      </div>

      <!-- Script List for Current Domain -->
      <section class="scripts-section">
        <h3 class="section-title">ğŸ“‚ å½“å‰åŸŸåä¸‹çš„è„šæœ¬</h3>
        
        <!-- Active Scripts -->
        <div id="active-scripts" class="script-list">
          <div class="empty-state">æ— æ¿€æ´»è„šæœ¬</div>
        </div>
        
        <!-- Inactive Scripts -->
        <div id="inactive-scripts" class="script-list inactive">
          <!-- Will be populated dynamically -->
        </div>
      </section>

      <!-- Chat Input Section -->
      <section class="chat-section">
        <div class="input-container">
          <textarea 
            id="user-request" 
            placeholder="æè¿°ä½ çš„éœ€æ±‚..."
            rows="2"
          ></textarea>
          <button id="send-btn" class="send-btn" title="å‘é€">
            <span class="send-icon">â¤</span>
          </button>
        </div>
      </section>

      <!-- Agent Status & Message -->
      <section class="agent-section">
        <div class="agent-status">
          <span id="status-indicator" class="status-dot idle"></span>
          <span id="status-text" class="status-text">ç©ºé—²</span>
        </div>
        <div id="agent-message" class="agent-message hidden">
          <span class="message-icon">ğŸ’¬</span>
          <span id="agent-message-text" class="message-text"></span>
        </div>
      </section>

      <!-- Result Section (shows generated script) -->
      <div id="result-section" class="result-section hidden">
        <div class="result-header">
          <h3>ç”Ÿæˆç»“æœ <span id="audit-score" class="audit-score"></span></h3>
          <button id="copy-btn" class="icon-btn" title="å¤åˆ¶">ğŸ“‹</button>
        </div>
        <pre id="script-output" class="script-output"></pre>
      </div>

      <!-- Model & Token Info -->
      <footer class="footer">
        <div class="model-info">
          <span class="model-icon">ğŸ¤–</span>
          <span id="model-name">DeepSeek V3.2 via OpenRouter</span>
        </div>
        <div class="token-info">
          <span class="token-icon">ğŸ“Š</span>
          <span id="token-usage">0 / 10000000</span>
        </div>
      </footer>

      <!-- Other Domain Scripts (Collapsible) -->
      <section class="other-scripts-section collapsed">
        <button id="toggle-other-scripts" class="section-toggle">
          <span class="toggle-icon">â–¶</span>
          <span>ğŸ“ å…¶ä»–åŸŸåçš„è„šæœ¬</span>
          <span id="other-scripts-count" class="count-badge">0</span>
        </button>
        <div id="other-scripts" class="other-scripts-list hidden">
          <!-- Will be populated dynamically -->
        </div>
      </section>

      <!-- Interaction Modal -->
      <div id="interaction-modal" class="modal hidden">
        <div class="modal-content">
          <div class="modal-header">
            <h3 id="interaction-title">Agent è¯·æ±‚</h3>
          </div>
          <div class="modal-body">
            <p id="interaction-prompt"></p>
            <div id="interaction-input-container" class="form-group hidden">
              <input type="text" id="interaction-input" class="form-control" />
            </div>
            <div id="interaction-choices" class="button-group">
              <!-- Buttons will be added here -->
            </div>
          </div>
        </div>
      </div>

      <!-- Settings Modal -->
      <div id="settings-modal" class="modal hidden">
        <div class="modal-content">
          <div class="modal-header">
            <h3>è®¾ç½®</h3>
            <button id="close-settings" class="icon-btn">âœ•</button>
          </div>
          <div class="modal-body">
            <div class="form-group">
              <label for="openrouter-key">OpenRouter API Key</label>
              <input 
                type="password" 
                id="openrouter-key" 
                placeholder="sk-or-v1-..."
              />
            </div>
            <div class="form-group">
              <label for="mem0-key">Mem0 API Key (å¯é€‰)</label>
              <input 
                type="password" 
                id="mem0-key" 
                placeholder="mem0_..."
              />
            </div>
            <button id="save-settings" class="btn btn-primary">ä¿å­˜</button>
          </div>
        </div>
      </div>

      <!-- Loading Overlay -->
      <div id="loading" class="loading hidden">
        <div class="spinner"></div>
        <span id="loading-text">æ­£åœ¨å¤„ç†...</span>
      </div>
    </div>
    <script type="module" src="./main.ts"></script>
  </body>
</html>
